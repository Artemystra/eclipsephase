
<div class="alignCenter">
  <p>{{localize "ep2e.roll.announce.rolled"}} <span class="resource-value">{{taskName}}</span></p>
  {{#if (eq rolledFrom "psiSleight")}}
    <p><span class="resource-value">{{itemdata.name}} </span><a class="GMinfo"><i class="fa-regular fa-circle-info moreInfo awesomeIcon" data-title="{{itemdata.name}}" data-resource="{{options.raiseInfection}}" data-description="{{itemdata.description}}" data-action="{{itemdata.action}}" data-duration="{{itemdata.duration}}"  data-rolledfrom="{{rolledFrom}}"></i></a></p>
  {{/if}}
  {{#if (eq rollMode "gmroll")}}
    <h5 style='font-weight: normal; margin: 0;'>{{localize "ep2e.roll.rollType.private"}} <i class='fas fa-eye-slash awesomeIcon'></i></h5>
  {{else if (eq rollMode "blindroll")}}
    <h5 style='font-weight: normal; margin: 0;'>{{localize "ep2e.roll.rollType.blind"}} <i class='fas fa-low-vision awesomeIcon'></i></h5>
  {{/if}}

  {{#if options.raiseInfection}}
    <h5 style='font-weight: normal; margin: 0;'>{{localize "ep2e.roll.announce.infectionRaise"}} <strong>{{options.totalInfection}}</strong></h5><p>
  {{/if}}
  <p></p><div style="display: flex; flex-wrap: wrap; margin-bottom: 20px; padding-top: 20px; background-color: var(--pitchBorder); align-items: center; justify-content: center;">
    <span class="{{resultClass}}" style="min-width: 100%; margin-bottom: 20px;">{{localize resultText}}</span> <p>

      <div class="item privateChatButton" style="min-width: 100%; cursor: pointer; background-color: var(--mainBackground);" data-ownerid={{actor._id}}>
        {{#if alternatives.options.swap}}
        <div class="slideShow">
          <div class="showFlex" style="padding: 5px 10px; justify-content: center;">
            <strong>{{localize "ep2e.chat.buttonLabel.swapResult"}} <i class="fa-solid fa-rotate"></i></strong>
          </div>
        </div>
        <div class="showMore noShow">
          <div style="display: flex; min-width: 100%; justify-content: space-between; padding: 10px 10px;">
            {{#if (eq actor.type "character")}}
              {{#if (gt pools.skillPoolValue 0)}}
                <button class="chatPoolButton usePool autoClose" data-actorid="{{actor._id}}" data-userid="{{userID}}" data-usepool="pool" data-usagetype="swapped" data-pooltype="{{pools.poolType}}" data-updatepoolpath="{{pools.updatePoolPath}}" data-resultclass="{{alternatives.resultClass}}" data-resulttext="{{alternatives.resultText}}" data-skillpoolvalue="{{pools.skillPoolValue}}" data-newresult="{{alternatives.result}}" data-rollmode="{{rollMode}}" data-weaponid="{{itemdata.weaponID}}" data-weaponmode="{{itemdata.weaponMode}}" data-attackmode="{{options.attackMode}}" data-biomorphtarget="{{options.biomorphTarget}}" data-rolledfrom="{{rolledFrom}}" data-touchonly="{{options.touchOnly}}">{{localize pools.useMessage}}</button>
              {{else}}
                <button class="chatPoolButton" disabled>{{localize pools.useMessage}}</button>
              {{/if}}
              {{#if (gt pools.flexPoolValue 0)}}
                <button class="chatPoolButton usePool autoClose" data-actorid="{{actor._id}}" data-userid="{{userID}}" data-usepool="flex" data-usagetype="swapped" data-updateflexpath="{{pools.updateFlexPath}}" data-resultclass="{{alternatives.resultClass}}" data-resulttext="{{alternatives.resultText}}" data-flexpoolvalue="{{pools.flexPoolValue}}" data-newresult="{{alternatives.result}}" data-rollmode="{{rollMode}}" data-weaponid="{{itemdata.weaponID}}" data-weaponmode="{{itemdata.weaponMode}}" data-attackmode="{{options.attackMode}}" data-biomorphtarget="{{options.biomorphTarget}}" data-rolledfrom="{{rolledFrom}}" data-touchonly="{{options.touchOnly}}">{{localize "ep2e.skills.pool.use.flex"}}</button>
              {{else}}
                <button class="chatPoolButton" disabled>{{localize "ep2e.skills.pool.use.flex"}}</button>
              {{/if}}
            {{else}}
                <button class="chatPoolButton threatButton usePool autoClose" data-actorid="{{actor._id}}" data-userid="{{userID}}" data-usepool="pool" data-usagetype="swapped" data-pooltype="{{pools.poolType}}" data-updatepoolpath="{{pools.updatePoolPath}}" data-resultclass="{{alternatives.resultClass}}" data-resulttext="{{alternatives.resultText}}" data-skillpoolvalue="{{pools.skillPoolValue}}" data-newresult="{{alternatives.result}}" data-rollmode="{{rollMode}}" data-weaponid="{{itemdata.weaponID}}" data-weaponmode="{{itemdata.weaponMode}}" data-attackmode="{{options.attackMode}}" data-biomorphtarget="{{options.biomorphTarget}}" data-rolledfrom="{{rolledFrom}}" data-touchonly="{{options.touchOnly}}">{{localize pools.useMessage}}</button>
            {{/if}}
          </div>
        </div>

        {{else if alternatives.options.upgrade}}
        <div class="slideShow">
          <div class="showFlex" style="padding: 5px 10px; justify-content: center;">
            <strong>{{localize "ep2e.chat.buttonLabel.upgradeResult"}} <i class="fa-regular fa-circle-up"></i></strong>
          </div>
        </div>
        <div class="showMore noShow">
          <div style="display: flex; min-width: 100%; justify-content: space-between; padding: 10px 10px;">
            {{#if (eq actor.type "character")}}
              {{#if (gt pools.skillPoolValue 0)}}
                <button class="chatPoolButton usePool autoClose" data-actorid="{{actor._id}}" data-userid="{{userID}}" data-usepool="pool" data-usagetype="upgraded" data-pooltype="{{pools.poolType}}" data-updatepoolpath="{{pools.updatePoolPath}}" data-resultclass="{{alternatives.resultClass}}" data-resulttext="{{alternatives.resultText}}" data-skillpoolvalue="{{pools.skillPoolValue}}" data-newresult="{{alternatives.result}}" data-rollmode="{{rollMode}}" data-weaponid="{{itemdata.weaponID}}" data-weaponmode="{{itemdata.weaponMode}}" data-attackmode="{{options.attackMode}}" data-biomorphtarget="{{options.biomorphTarget}}" data-rolledfrom="{{rolledFrom}}" data-touchonly="{{options.touchOnly}}">{{localize pools.useMessage}}</button>
              {{else}}
                <button class="chatPoolButton" disabled>{{localize pools.useMessage}}</button>
              {{/if}}
              {{#if (gt pools.flexPoolValue 0)}}
                <button class="chatPoolButton usePool autoClose" data-actorid="{{actor._id}}" data-userid="{{userID}}" data-usepool="flex" data-usagetype="upgraded" data-updateflexpath="{{pools.updateFlexPath}}" data-resultclass="{{alternatives.resultClass}}" data-resulttext="{{alternatives.resultText}}" data-flexpoolvalue="{{pools.flexPoolValue}}" data-newresult="{{alternatives.result}}" data-rollmode="{{rollMode}}" data-weaponid="{{itemdata.weaponID}}" data-weaponmode="{{itemdata.weaponMode}}" data-attackmode="{{options.attackMode}}" data-biomorphtarget="{{options.biomorphTarget}}" data-rolledfrom="{{rolledFrom}}" data-touchonly="{{options.touchOnly}}">{{localize "ep2e.skills.pool.use.flex"}}</button>
              {{else}}
                <button class="chatPoolButton" disabled>{{localize "ep2e.skills.pool.use.flex"}}</button>
              {{/if}}
            {{else}}
                <button class="chatPoolButton threatButton usePool autoClose" data-actorid="{{actor._id}}" data-userid="{{userID}}" data-usepool="pool" data-usagetype="upgraded" data-pooltype="{{pools.poolType}}" data-updatepoolpath="{{pools.updatePoolPath}}" data-resultclass="{{alternatives.resultClass}}" data-resulttext="{{alternatives.resultText}}" data-newresult="{{alternatives.result}}" data-skillpoolvalue="{{pools.skillPoolValue}}" data-rollmode="{{rollMode}}" data-weaponid="{{itemdata.weaponID}}" data-weaponmode="{{itemdata.weaponMode}}" data-attackmode="{{options.attackMode}}" data-biomorphtarget="{{options.biomorphTarget}}" data-rolledfrom="{{rolledFrom}}" data-touchonly="{{options.touchOnly}}">{{localize pools.useMessage}}</button>
            {{/if}}
          </div>
        </div>

        {{else if alternatives.options.mitigate}}
        <div class="slideShow">
          <div class="showFlex" style="padding: 5px 10px; justify-content: center;">
            <strong>{{localize "ep2e.chat.buttonLabel.mitigateResult"}} <i class="fa-solid fa-bolt"></i></strong>
          </div>
        </div>
        <div class="showMore noShow">
          <div style="display: flex; min-width: 100%; justify-content: space-between; padding: 10px 10px;">
            {{#if (eq actor.type "character")}}
              {{#if (gt pools.skillPoolValue 0)}}
                <button class="chatPoolButton usePool autoClose" data-actorid="{{actor._id}}" data-userid="{{userID}}" data-usepool="pool" data-usagetype="mitigated" data-pooltype="{{pools.poolType}}" data-updatepoolpath="{{pools.updatePoolPath}}" data-resultclass="{{alternatives.resultClass}}" data-resulttext="{{alternatives.resultText}}" data-skillpoolvalue="{{pools.skillPoolValue}}" data-newresult="{{alternatives.result}}" data-rollmode="{{rollMode}}" data-attackmode="{{options.attackMode}}" data-biomorphtarget="{{options.biomorphTarget}}" data-rolledfrom="{{rolledFrom}}" data-touchonly="{{options.touchOnly}}">{{localize pools.useMessage}}</button>
              {{else}}
                <button class="chatPoolButton" disabled>{{localize pools.useMessage}}</button>
              {{/if}}
              {{#if (gt pools.flexPoolValue 0)}}
                <button class="chatPoolButton usePool autoClose" data-actorid="{{actor._id}}" data-userid="{{userID}}" data-usepool="flex" data-usagetype="mitigated" data-updateflexpath="{{pools.updateFlexPath}}" data-resultclass="{{alternatives.resultClass}}" data-resulttext="{{alternatives.resultText}}" data-flexpoolvalue="{{pools.flexPoolValue}}" data-newresult="{{alternatives.result}}" data-rollmode="{{rollMode}}" data-attackmode="{{options.attackMode}}" data-biomorphtarget="{{options.biomorphTarget}}" data-rolledfrom="{{rolledFrom}}" data-touchonly="{{options.touchOnly}}">{{localize "ep2e.skills.pool.use.flex"}}</button>
              {{else}}
                <button class="chatPoolButton" disabled>{{localize "ep2e.skills.pool.use.flex"}}</button>
              {{/if}}
            {{else}}
                <button class="chatPoolButton threatButton usePool autoClose" data-actorid="{{actor._id}}" data-userid="{{userID}}" data-usepool="pool" data-usagetype="mitigated" data-pooltype="{{pools.poolType}}" data-updatepoolpath="{{pools.updatePoolPath}}" data-resultclass="{{alternatives.resultClass}}" data-resulttext="{{alternatives.resultText}}" data-skillpoolvalue="{{pools.skillPoolValue}}" data-newresult="{{alternatives.result}}" data-rollmode="{{rollMode}}" data-attackmode="{{options.attackMode}}" data-biomorphtarget="{{options.biomorphTarget}}" data-rolledfrom="{{rolledFrom}}" data-touchonly="{{options.touchOnly}}">{{localize pools.useMessage}}</button>
            {{/if}}
          </div>
        </div>
        {{/if}}
      </div>
  </div>

  {{#if modifiers}}
    <div class="item" style="cursor: pointer; background-color: var(--focusBackground); padding: 0.75em 0;">
      <div class="slideShow">
        <div class="showFlex" style="padding: 0 10px; justify-content: space-between;">
          <strong>{{localize "ep2e.roll.announce.appliedMods"}}</strong>
          {{#if (gt modValue 0)}}
           <strong style="color: var(--positive);">+{{modValue}}</strong>
          {{/if}}
          {{#if (lt modValue 0)}}
          <strong style="color: var(--negative);">{{modValue}}</strong>
          {{/if}}
        </div>
        <div class="noShow" style="padding: 0 10px; justify-content: space-between;">
          <strong>{{localize "ep2e.roll.announce.appliedMods"}}</strong>
          {{#if (gt modValue 0)}}
           <strong style="color: var(--positive);">+{{modValue}}</strong>
          {{/if}}
          {{#if (lt modValue 0)}}
          <strong style="color: var(--negative);">{{modValue}}</strong>
          {{/if}}
        </div>
      </div>
      <div class="showMore noShow">
        <table>
          <tr>
            <td class="table-dice-label">
              {{localize "ep2e.roll.announce.baseValue"}}
            </td>
            <td class="table-dice-result">
              <strong>{{taskValue}}</strong>
            </td>
          </tr>
          {{#each modifiers}}
          <tr>
            <td class="table-dice-label">
              {{localize text}}
              {{#if comment}}
              <br><label style="font-size: 12px">{{localize comment}}</label>
              {{/if}}
            </td>
            <td class="table-dice-result">
              {{#if (gt value 0)}}
               <strong style="color: var(--positive);">{{value}}</strong>
              {{/if}}
              {{#if (lt value 0)}}
              <strong style="color: var(--negative);">{{value}}</strong>
              {{/if}}
            </td>
          </tr>
          {{/each}}
        </table>
      </div>
    </div>
  {{/if}}
    {{log rollType}}
  {{> systems/eclipsephase/templates/chat/partials/roll-results.html targetNumber=targetNumber diceBreakdown=diceBreakdown formula=formula total=total resultClass=resultClass}}

  {{#if (and (eq taskName "Psi")(eq alternatives.options.available true)(ne options.ignoreInfection true))}}
      <button class="chatActionButton psiEffect privateChatButton" data-actorid="{{actor._id}}" data-userid="{{userID}}" data-psipush="{{options.push}}">{{localize "ep2e.chat.buttonLabel.psiInfection"}}</button>
  {{/if}}

  {{#if (or (eq rolledFrom "rangedWeapon")(eq rolledFrom "ccWeapon"))}}
    {{#if (or (eq resultClass "success")(eq itemdata.weaponTraits.automatedEffects.dvOnMiss.value true))}}
      <button class="chatActionButton weaponDamage privateChatButton" data-actorid="{{actor._id}}" data-userid="{{userID}}" data-weaponid="{{itemdata.weaponID}}" data-weaponmode="{{itemdata.weaponMode}}" data-rolledfrom="{{rolledFrom}}" data-rollresult="{{alternatives.originalResult}}" data-attackmode="{{options.attackMode}}" data-biomorphtarget="{{options.biomorphTarget}}" data-touchonly="{{options.touchOnly}}" data-rollmode="{{rollMode}}">{{localize "ep2e.chat.buttonLabel.weaponDamage"}}</button>
    {{/if}}
  {{/if}}
</div>

